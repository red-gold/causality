!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("causal-net.core"),require("causal-net.utils"),require("causal-net.storage"),require("causal-net.log")):"function"==typeof define&&define.amd?define(["causal-net.core","causal-net.utils","causal-net.storage","causal-net.log"],t):"object"==typeof exports?exports["@causalNet/preprocessing"]=t(require("causal-net.core"),require("causal-net.utils"),require("causal-net.storage"),require("causal-net.log")):e["@causalNet/preprocessing"]=t(e["causal-net.core"],e["causal-net.utils"],e["causal-net.storage"],e["causal-net.log"])}(this,function(e,t,r,s){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=s},function(e,t){},function(e,t,r){"use strict";r.r(t);var s=r(0),n=r(1),a=r(2),o=r(3);var i=new s.Functor,l=new class extends(n.platform.mixWith(s.Event,[a.StorageMixins])){constructor(e,t,r){super(),this.Storage=e,this.F=t,this.logger=r,this.preprocessingData={samples:[],labels:[],finished:!1,trainSet:[],testSet:[]}}get PreprocessingData(){return this.preprocessingData}get TrainSet(){return this.preprocessingData.trainSet}get TestSet(){return this.preprocessingData.testSet}set SampleTransformer(e){this.sampleFn=e}set LabelTransformer(e){this.labelFn=e}get SampleTransformer(){if(!this.sampleFn)throw Error("SampleTransformer is not set");return this.sampleFn}get LabelTransformer(){if(!this.labelFn)throw Error("LabelTransformer is not set");return this.labelFn}get DataHandler(){if(!this.dataHandler)throw Error("DataHandler is not set");this.dataHandler}setDataHandler(){const e=this.SampleTransformer,t=this.LabelTransformer,r=this.Storage;this.dataHandler=(s=>new Promise(async(n,a)=>{let o=s.ChunkName;if(void 0===o&&a("chunkName is not defined"),s.Sample){let t=e(s.Sample),n="";for(let[e,s]of this.F.enumerate(t))n=o+"/"+e,await r.setItem("preprocessing/sample/"+n,JSON.stringify(s)),this.preprocessingData.samples.push(n)}if(s.Label){let e=t(s.Label),n="";for(let[t,s]of this.F.enumerate(e))n=o+"/"+t,await r.setItem("preprocessing/label/"+n,JSON.stringify(s)),this.preprocessingData.labels.push(n)}n(!0)})),this.on("data",this.dataHandler)}splitDataset(e=.9){const t=this.F.CoreFunctor;let{samples:r,labels:s}=this.preprocessingData,n=this.F.zip(r,s);e<1&&(e=parseInt(.9*n.length));const[a,o]=t.splitAt(e,n);return this.preprocessingData.trainSet=a,this.preprocessingData.testSet=o,[a,o]}makeBatchGenerator(e){const t=this.Storage;let r=0;return{next:async()=>{let s=[],n=[];for(let[a,o]of e[r]){a="preprocessing/sample/"+a,o="preprocessing/label/"+o;let e=await t.getItem(a),r=await t.getItem(o);s=[...s,JSON.parse(e[a])],n=[...n,JSON.parse(r[o])]}return r+=1,{samples:s,labels:n}},*[Symbol.iterator](){for(;r<e.length;)yield this.next()}}}get TrainDataGenerator(){const e=this.TrainSet,t=this.F.CoreFunctor;return r=>{let s=t.splitEvery(r,e);return this.makeBatchGenerator(s)}}get TestDataGenerator(){const e=this.TestSet,t=this.F.CoreFunctor;return r=>{let s=t.splitEvery(r,e);return this.makeBatchGenerator(s)}}}(a.indexDBStorage,i,o.termLogger);var c=e=>(class extends e{get Preprocessing(){if(!this.streamPreprocessing)throw Error("streamPreprocessing is not set");return this.streamPreprocessing}set Preprocessing(e){this.streamPreprocessing=e}setByConfig(e){super.setByConfig&&super.setByConfig(e);const{Preprocessing:t}=e.Dataset;if(this.Logger.groupBegin("preprocessing"),this.DataSource&&t){const{SampleTransformer:r,LabelTransformer:s}=t;this.Preprocessing.SampleTransformer=r,this.Preprocessing.LabelTransformer=s,this.Preprocessing.setDataHandler(),e.TrainDataGenerator=this.Preprocessing.TrainDataGenerator,e.TestDataGenerator=this.Preprocessing.TestDataGenerator}return this.Logger.groupEnd(),e}});var u=e=>(class extends e{colorTransform(e,t,r){const s=this.R;return s.flatten(s.map(e,s.splitEvery(r,t)))}blackWhiteTransform(e,t){return this.colorTransform(e=>~~((e[0]+e[1]+e[2])/3),e,t)}});var p=e=>(class extends e{imageSplit(e,t){return this.R.splitEvery(t,e)}});var f=new class extends(n.platform.mixWith(s.Functor,[u,p])){constructor(){super()}};var g=e=>(class extends e{tokenize(e){return this.R,this.tokenizer.tokenize(e)}badWordsFilter(e,t){const r=this.R;return r.filter(e=>r.not(r.find(r.equals(e))(t)),e)}wordFreqCount(e,t={}){return this.R.reduce((e,t)=>(void 0===e[t]?e[t]=1:e[t]+=1,e),t,e)}wordDuplicateRemove(e){return this.R.uniq(e)}});var h=new class extends(n.platform.mixWith(s.Functor,[g])){constructor(){super()}connect(e){this.tokenizer.connect(e)}get Tokenizer(){if(!this.tokenizer)throw Error("tokenizer is not set");return this.tokenizer}set Tokenizer(e){this.tokenizer=e}};r(4);var m=new class extends(n.platform.mixWith(s.Functor,[])){constructor(){super()}};var d=new class{constructor(){}connect(e){console.log("This simple English tokenizer not requires advance configure")}tokenize(e){return e.split(/[\s."'\/\|;:()\[\]\@\#\$\&]/g).filter(e=>""!==e)}};r.d(t,"causalNetPreprocessingStream",function(){return l}),r.d(t,"PreprocessingMixins",function(){return c}),r.d(t,"imagePreprocessing",function(){return f}),r.d(t,"nlpPreprocessing",function(){return h}),r.d(t,"tabularPreprocessing",function(){return m}),r.d(t,"tokenizerEN",function(){return d})}])});
//# sourceMappingURL=preprocessing.web.js.map